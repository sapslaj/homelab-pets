- hosts: all
  become: true
  vars:
    nordvpn_username: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      36323230333766663662313966373266383262396363393362616134333835623930353935323431
      6436346132373162366266613666663035646332353031370a336437656233663263383332633737
      31336663356163326434653861663035663233633538353665666662376164373164356438643461
      3438373163343239350a613930303438643030353738616439303235306138623432633963353361
      31613263653539336331363639636239613263623634386464373261626433323731
    nordvpn_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      36646337386665653163303138363964633363313766303633343130316438336434623666653264
      6132373831353038663466346564303336363237646366350a613861316533306261653734373631
      66663231626438303233613166386635303861376331623231613863363330306361346239626161
      6334396265333035660a346662346465623636366230626133333136623131316366333561636366
      66376133316662636565666534613734656237623234316466373439663461393861313561643735
      39376634623134373536333937383134376534633364636135363761333530393761393662363936
      636234356138306338323433333066386330
  tasks:
    - name: config directories
      file:
        path: '{{ item }}'
        state: directory
      with_items:
        - /mnt/spank-bank/volumes/pvr/jackett-config
        - /mnt/spank-bank/volumes/pvr/radarr-config
        - /mnt/spank-bank/volumes/pvr/sonarr-config
    - name: vpn container
      docker_container:
        name: vpn
        image: bubuntux/nordvpn:v3.9.1
        restart_policy: unless-stopped
        capabilities:
          - NET_ADMIN
        etc_hosts:
          w569ut7zbkiqf5b.xyz: 104.28.28.105
          zwyr157wwiu6eior.com: 104.17.188.107
          boi9osyg1uwtyafn.com: 104.16.229.42
          cdn.zwyr157wwiu6eior.com: 104.17.207.102
        ports:
          - 0.0.0.0:9117:9117 # Jackett
          - '[::]:9117:9117'
        env:
          USER: '{{ nordvpn_username | trim }}'
          PASS: '{{ nordvpn_password | trim }}'
          CONNECT: United_States
          TECHNOLOGY: NordLynx
          DEBUG: 'on'
          NETWORK: 172.16.0.0/12
    - name: jackett container
      docker_container:
        name: jackett
        image: linuxserver/jackett
        restart_policy: unless-stopped
        network_mode: container:vpn
        env:
          PUID: '33'
          PGID: '33'
          TZ: America/New_York
        volumes:
          - /mnt/spank-bank/volumes/pvr/jackett-config:/config
    - name: sonarr container
      docker_container:
        name: sonarr
        image: linuxserver/sonarr
        restart_policy: unless-stopped
        links:
          - vpn:jackett
        ports:
          - 0.0.0.0:8989:8989
          - '[::]:8989:8989'
        env:
          PUID: '0'
          PGID: '0'
        volumes:
          - /mnt/spank-bank/volumes/pvr/sonarr-config:/config
          - /mnt/spank-bank/Media:/data
    - name: radarr container
      docker_container:
        name: radarr
        image: linuxserver/radarr
        restart_policy: unless-stopped
        links:
          - vpn:jackett
        ports:
          - 0.0.0.0:7878:7878
          - '[::]:7878:7878'
        env:
          PUID: '0'
          PGID: '0'
        volumes:
          - /mnt/spank-bank/volumes/pvr/radarr-config:/config
          - /mnt/spank-bank/Media:/data
    - name: lidarr container
      docker_container:
        name: lidarr
        image: lscr.io/linuxserver/lidarr
        restart_policy: unless-stopped
        links:
          - vpn:jackett
        ports:
          - 0.0.0.0:8686:8686
          - '[::]:8686:8686'
        env:
          PUID: '0'
          PGID: '0'
        volumes:
          - /mnt/spank-bank/volumes/pvr/lidarr-config:/config
          - /mnt/spank-bank/Media:/data
